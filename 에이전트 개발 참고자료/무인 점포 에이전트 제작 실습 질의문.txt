[Cursor ì‚¬ìš© ë¬´ì¸ ì í¬ ì—ì´ì „íŠ¸ ì œì‘ ì‹¤ìŠµ ì§ˆì˜ë¬¸]

==========================================================
í”„ë¡œì íŠ¸ í´ë”ëª…: AI_Agent_AmazonGo_Store
===========================================================

ë‹¤ìŒ ìš”êµ¬ì‚¬í•­ì„ ëª¨ë‘ ë°˜ì˜í•˜ì—¬ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ë¥¼ ìë™ ìƒì„±í•´ì¤˜.

ğŸ“Œ ìµœì¢… ëª©í‘œ
ì¹´ë©”ë¼ë¡œ ì´¬ì˜í•œ ì§§ì€ ì˜ìƒ ë˜ëŠ” ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼(í”„ë ˆì„ ë‹¨ìœ„)ì„ ì…ë ¥í•˜ë©´,

1) ì‚¬ëŒ ê²€ì¶œ  
2) ì†/íŒ” ì˜ì—­ ì¶”ì   
3) ìƒí’ˆ ì„ ë°˜ ì¸ì‹  
4) â€œPick(ì§‘ì—ˆë‹¤)â€ vs â€œPut(ë†“ì•˜ë‹¤)â€ íŒë‹¨  
5) Pickì´ë©´ ìë™ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€  
6) ì¥ë°”êµ¬ë‹ˆ ê¸ˆì•¡ ìë™ ê³„ì‚°  
7) LangChain create_agent() ê¸°ë°˜ Workflow í†µì œ  
8) Streamlit UIë¡œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§  

ì„ êµ¬í˜„í•˜ëŠ” **ë¬´ì¸ ì í¬ AI ì—ì´ì „íŠ¸ ì „ì²´ í”„ë¡œì íŠ¸**ë¥¼ ìƒì„±í•´ì¤˜.

â€» ì˜ìƒì—ì„œ â€œìƒí’ˆì„ ì†ìœ¼ë¡œ ì§‘ëŠ” ìˆœê°„â€ì„ ì¸ì‹í•˜ëŠ” ë° ì´ˆì ì„ ë§ì¶˜ë‹¤.
â€» ì—…ë¡œë“œ ë°©ì‹ì€ â€œì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œâ€ê°€ ì•„ë‹ˆë¼ â€œì˜ìƒ íŒŒì¼ ì—…ë¡œë“œ or í”„ë ˆì„ ìë™ ì¶”ì¶œâ€.

===========================================================
ğŸ“ 1. í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°
===========================================================

AI_Agent_AmazonGo_Realtime/
 â”œâ”€â”€ app.py                 # Streamlit UI
 â”œâ”€â”€ agent.py               # LangChain create_agent() ì—ì´ì „íŠ¸
 â”œâ”€â”€ vision_core.py         # ì˜ìƒ ì²˜ë¦¬(Pick/Put) í•µì‹¬ ë¡œì§
 â”œâ”€â”€ product_db.py          # ìƒí’ˆ/ê°€ê²© ë°ì´í„°ë² ì´ìŠ¤
 â”œâ”€â”€ utils.py               # í”„ë ˆì„ ë³€í™˜/ë””ë²„ê·¸ í•¨ìˆ˜
 â”œâ”€â”€ requirements.txt
 â””â”€â”€ README.md


===========================================================
ğŸ“¦ 2. requirements.txt ìƒì„±
===========================================================

streamlit
opencv-python
langchain
langchain-core
langchain-openai
python-dotenv
Pillow


===========================================================
ğŸ§° 3. product_db.py (ìƒí’ˆ + ì„ ë°˜ ìœ„ì¹˜)
===========================================================

êµ¬í˜„ ìš”êµ¬:
- ìƒí’ˆ ì´ë¦„ + ê°€ê²©
- ì„ ë°˜ ìœ„ì¹˜ë¥¼ bounding box í˜•íƒœë¡œ ì„¤ì •(ì˜ˆ: x1,y1,x2,y2)
- ì¹´ë©”ë¼ ì˜ìƒì—ì„œ ì‚¬ëŒì´ íŠ¹ì • ì„ ë°˜ ë²”ìœ„ì— ì†ì„ ë„£ìœ¼ë©´ â€œPick í›„ë³´â€

ì˜ˆì‹œ ì½”ë“œ:
-----------------------------------------------------------
PRODUCTS = {
    "chips": 2000,
    "cola": 1500,
    "water": 1000,
    "sandwich": 3500
}

# ì„ ë°˜ ìœ„ì¹˜(ì˜ˆ: ì¢Œí‘œ ì²´ê³„ëŠ” ì˜ìƒ í¬ê¸°ì— ë§ê²Œ ì¡°ì •)
SHELF_ZONES = {
    "chips": (50, 100, 250, 300),
    "cola": (300, 100, 500, 300),
    "water": (50, 350, 250, 550),
    "sandwich": (300, 350, 500, 550)
}

def get_price(product):
    return PRODUCTS.get(product, -1)
-----------------------------------------------------------


===========================================================
ğŸ¥ 4. vision_core.py â€” Pick/Put íŒì • ë¡œì§
===========================================================

êµ¬í˜„ ìš”êµ¬:
1) ì˜ìƒ íŒŒì¼ ì…ë ¥ â†’ í”„ë ˆì„ ì¶”ì¶œ (opencv)
2) ì‚¬ëŒ ê°ì§€ â†’ ì† ìœ„ì¹˜ë§Œ ì¶”ì¶œ
3) ì† ì¢Œí‘œê°€ ì–´ë–¤ ì„ ë°˜ ì˜ì—­ì— ë“¤ì–´ê°”ëŠ”ì§€ íŒë‹¨
4) ì´ì „ í”„ë ˆì„ì—” ìˆì—ˆê³  í˜„ì¬ í”„ë ˆì„ì—” ìƒí’ˆì´ ì‚¬ë¼ì¡Œë‹¤ë©´ â†’ Pick
5) ê°„ë‹¨í•œ Rule ê¸°ë°˜ Pick ì¶”ì •ìœ¼ë¡œ ì¶©ë¶„

OpenAI Vision APIëŠ” â€œì†ì´ ìƒí’ˆ ì•ì— ìˆëŠ”ì§€â€, â€œì–´ë–¤ ìƒí’ˆì¸ì§€â€ ì¶”ë¡ í•˜ëŠ” ë° ë³´ì¡° í™œìš©.

ì˜ˆì‹œ ì½”ë“œ:
-----------------------------------------------------------
import cv2
from openai import OpenAI
from product_db import SHELF_ZONES

client = OpenAI()

def extract_frames(video_path, skip=5):
    cap = cv2.VideoCapture(video_path)
    frames = []
    count = 0
    while True:
        ret, frame = cap.read()
        if not ret:
            break
        if count % skip == 0:
            frames.append(frame)
        count += 1
    cap.release()
    return frames

def detect_hand_zone(frame):
    """
    Vision APIë¡œ ì† ìœ„ì¹˜ë¥¼ ì¶”ì •í•œë‹¤.
    ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ ì†ì´ ìœ„ì¹˜í•œ ëŒ€ëµì  bboxë§Œ ë°›ì•„ì˜¨ë‹¤ê³  ê°€ì •.
    """
    # frame â†’ base64 ë³€í™˜
    import base64
    _, buffer = cv2.imencode(".jpg", frame)
    img_base64 = base64.b64encode(buffer).decode("utf-8")

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[
            {"role": "system", "content": "ì´ë¯¸ì§€ì—ì„œ ì†ì˜ ëŒ€ëµì ì¸ ìœ„ì¹˜ë¥¼ x1,y1,x2,y2 í˜•íƒœë¡œ ìˆ«ìë¡œë§Œ ì œê³µí•´ë¼."},
            {
                "role": "user",
                "content": [
                    {"type": "input_text", "text": "ì†ì˜ ìœ„ì¹˜ bboxë¥¼ ì°¾ê³  ìˆ«ìë§Œ ë°˜í™˜í•´ë¼."},
                    {"type": "input_image", "image_url": f"data:image/jpeg;base64,{img_base64}"}
                ]
            }
        ]
    )
    text = response.choices[0].message["content"]
    # "100,120,180,250" í˜•íƒœ íŒŒì‹±
    try:
        parts = list(map(int, text.replace(" ", "").split(",")))
        return tuple(parts)  # (x1,y1,x2,y2)
    except:
        return None

def determine_pick(prev_hand_zone, curr_hand_zone):
    """ë‹¨ìˆœ ê·œì¹™ ê¸°ë°˜: ì†ì´ ì„ ë°˜ ì˜ì—­ì„ í†µê³¼í•˜ë©´ Pick ë°œìƒ ê°€ëŠ¥."""
    if not curr_hand_zone:
        return None

    x1, y1, x2, y2 = curr_hand_zone

    # ì„ ë°˜ ì˜ì—­ì— ë“¤ì–´ê°”ëŠ”ì§€ ì²´í¬
    for product, (sx1, sy1, sx2, sy2) in SHELF_ZONES.items():
        if x1 >= sx1 and y1 >= sy1 and x2 <= sx2 and y2 <= sy2:
            return product
    
    return None
-----------------------------------------------------------

- í™˜ê²½ ë³€ìˆ˜ëŠ” .env íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ë¶ˆëŸ¬ì˜¤ê¸° :  load_dotenv("C:/env/.env")

===========================================================
ğŸ¤– 5. agent.py â€” LangChain create_agent() ì—ì´ì „íŠ¸
===========================================================

êµ¬í˜„ ìš”êµ¬:
- Tool: analyze_video(video_path), add_to_cart(product), get_cart_total()
- cart ì „ì—­ ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©
- agent.invoke â†’ result["messages"][-1].content

ì˜ˆì‹œ ì½”ë“œ:
-----------------------------------------------------------
from langchain_openai import ChatOpenAI
from langchain.agents import create_agent
from langchain.tools import tool
from vision_core import extract_frames, detect_hand_zone, determine_pick
from product_db import get_price
from typing import List

cart = []

@tool
def analyze_video(video_path: str) -> str:
    """ì˜ìƒ ë¶„ì„ â†’ Pickëœ ìƒí’ˆ ê°ì§€."""
    frames = extract_frames(video_path)
    prev_hand = None
    picks = []

    for frame in frames:
        curr_hand = detect_hand_zone(frame)
        product = determine_pick(prev_hand, curr_hand)
        if product:
            picks.append(product)
        prev_hand = curr_hand
    
    if not picks:
        return "No product detected."
    
    return f"Detected picks: {', '.join(picks)}"

@tool
def add_to_cart(product: str) -> str:
    cart.append(product)
    return f"{product} added."

@tool
def get_cart_total(_: str="") -> str:
    total = sum(get_price(p) for p in cart)
    return f"Total amount: {total} KRW"

llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)

agent = create_agent(
    model=llm,
    tools=[analyze_video, add_to_cart, get_cart_total],
    system_prompt="ì¹´ë©”ë¼ ì˜ìƒì—ì„œ Pickëœ ìƒí’ˆì„ ê°ì§€í•˜ì—¬ ì¥ë°”êµ¬ë‹ˆì— ìë™ ì¶”ê°€í•˜ëŠ” ë¬´ì¸ ì í¬ Agentì´ë‹¤."
)

def run_agent(prompt: str):
    result = agent.invoke({"messages":[{"role":"user","content":prompt}]})
    return result["messages"][-1].content
-----------------------------------------------------------


===========================================================
ğŸ–¥ 6. Streamlit UI â€” app.py
===========================================================

êµ¬í˜„ ìš”êµ¬:
- ì˜ìƒ ì—…ë¡œë“œ
- â€œì˜ìƒ ë¶„ì„í•˜ê¸°â€ ë²„íŠ¼  
- Pickëœ ìƒí’ˆ í™•ì¸  
- Agentê°€ ìë™ìœ¼ë¡œ ì¥ë°”êµ¬ë‹ˆ ê´€ë¦¬  
- ì´ ê¸ˆì•¡ ì¡°íšŒ

ì˜ˆì‹œ ì½”ë“œ:
-----------------------------------------------------------
import streamlit as st
import os
from agent import run_agent

st.title("ğŸª ë¬´ì¸ ì í¬ AI (Amazon Go Simulation)")

video_file = st.file_uploader("ìƒí’ˆì„ ì§‘ëŠ” ì¥ë©´ì´ í¬í•¨ëœ ì˜ìƒì„ ì—…ë¡œë“œí•˜ì„¸ìš”", type=["mp4", "mov"])

if video_file:
    file_path = "uploaded_video.mp4"
    with open(file_path, "wb") as f:
        f.write(video_file.getbuffer())
    st.video(file_path)

    if st.button("ì˜ìƒ ë¶„ì„í•˜ê¸°"):
        response = run_agent(f"ì˜ìƒ {file_path} ì—ì„œ Pickëœ ìƒí’ˆì„ ë¶„ì„í•´ë¼.")
        st.success(response)

if st.button("ì¥ë°”êµ¬ë‹ˆ ì´ì•¡ ë³´ê¸°"):
    total = run_agent("ì¥ë°”êµ¬ë‹ˆ ì´ì•¡ì„ ê³„ì‚°í•´ë¼.")
    st.info(total)
-----------------------------------------------------------


===========================================================
ğŸ“˜ 7. README.md ìƒì„±
===========================================================

í”„ë¡œì íŠ¸ ì„¤ëª…  
ì„¤ì¹˜ ë°©ë²•  
ì‹¤í–‰ ë°©ë²•  
ì‹œë‚˜ë¦¬ì˜¤  
êµ¬ì„± íŒŒì¼ ì„¤ëª…  

ëª¨ë‘ ì‘ì„±í•´ì¤˜.


===========================================================
ìœ„ ì „ì²´ íŒŒì¼/ì½”ë“œë¥¼ ìƒì„±í•˜ê³  í”„ë¡œì íŠ¸ë¥¼ ì™„ì„±í•´ì¤˜.
===========================================================


[ì‹¤í–‰ ë°©ë²•]
C:\Users\storm\anaconda3\python.exe -m streamlit run app.py

[ì¶”ê°€ ì§ˆì˜-1]
ì˜ìƒì´ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì§€ ì•Šê³  ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ì˜ìƒìœ¼ë¡œ ê°ì§€í•˜ë„ë¡ ìˆ˜ì •í•´ì¤˜
